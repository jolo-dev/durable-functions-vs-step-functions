import{DynamoDBClient as c,GetItemCommand as m,DeleteItemCommand as l}from"@aws-sdk/client-dynamodb";import{SFNClient as y,SendTaskSuccessCommand as f}from"@aws-sdk/client-sfn";var g=new y({}),r=new c({}),k=async e=>{console.log(e);let d=typeof e.body=="string"?JSON.parse(e.body):e.body,{email:t,token:n,code:o}=d;if(!n||!o)return{statusCode:400,body:JSON.stringify({error:"token and code required"})};let s=await r.send(new m({TableName:process.env.TABLE_NAME,Key:{id:{S:t},sort:{S:o}}}));if(console.log("taskToken GetItemCommand",s),s.Item?.sort?.S!==o)return{statusCode:400,body:JSON.stringify({error:"Invalid verification code"})};let a=new f({taskToken:n,output:JSON.stringify({verification:"ok"})}),i=await g.send(a);return console.log("taskToken result",i),await r.send(new l({TableName:process.env.TABLE_NAME,Key:{id:{S:t}}})),{statusCode:200,body:JSON.stringify({message:"Verification accepted"})}};export{k as handler};

import{DynamoDBClient as a,GetItemCommand as c}from"@aws-sdk/client-dynamodb";import{SFNClient as m,SendTaskSuccessCommand as y}from"@aws-sdk/client-sfn";var l=new m({}),f=new a({}),p=async e=>{console.log(e);let s=typeof e.body=="string"?JSON.parse(e.body):e.body,{email:r,token:t,code:o}=s;if(!t||!o)return{statusCode:400,body:JSON.stringify({error:"token and code required"})};let n=await f.send(new c({TableName:process.env.TABLE_NAME,Key:{id:{S:r},sort:{S:o}}}));if(console.log("taskToken GetItemCommand",n),n.Item?.sort?.S!==o)return{statusCode:400,body:JSON.stringify({error:"Invalid verification code"})};let d=new y({taskToken:t,output:JSON.stringify({verification:"ok"})}),i=await l.send(d);return console.log("taskToken result",i),{statusCode:200,body:JSON.stringify({message:"Verification accepted"})}};export{p as handler};

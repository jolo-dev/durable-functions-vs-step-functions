import{DynamoDBClient as d,PutItemCommand as l,UpdateItemCommand as g}from"@aws-sdk/client-dynamodb";var o=new d({}),m=async t=>{console.log("Signal handler triggered:",JSON.stringify(t,null,2));try{let s=typeof t.body=="string"?JSON.parse(t.body):t.body,{requestId:n,code:e,taskToken:r}=s;if(!n||!e)return{statusCode:400,body:JSON.stringify({error:"Missing requestId"})};if(r){if(await o.send(new g({TableName:process.env.TABLE_NAME,Key:{id:{S:n},sort:{S:"0"}},UpdateExpression:"SET #signal = :signal",ExpressionAttributeNames:{"#signal":"signal"},ExpressionAttributeValues:{":signal":{S:JSON.stringify({code:e})}}})),e!==void 0){let{SFNClient:i,SendTaskSuccessCommand:a}=await import("@aws-sdk/client-sfn");await new i({}).send(new a({taskToken:r,output:JSON.stringify({code:e})}))}return{statusCode:200,body:JSON.stringify({message:"Signal sent to Step Functions",requestId:n,code:e})}}return await o.send(new l({TableName:process.env.TABLE_NAME,Item:{id:{S:`signal-${n}`},sort:{S:"0"},requestId:{S:n},code:{S:e},timestamp:{S:new Date().toISOString()}}})),{statusCode:200,body:JSON.stringify({message:"Signal stored for Durable Functions",requestId:n,code:e})}}catch(s){return console.error("Error in signal handler:",s),{statusCode:500,body:JSON.stringify({error:"Failed to process signal",details:s instanceof Error?s.message:"Unknown error"})}}};export{m as handler};

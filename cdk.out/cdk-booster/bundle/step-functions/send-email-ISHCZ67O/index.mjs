import{SESClient as d,SendEmailCommand as l}from"@aws-sdk/client-ses";import{DynamoDBClient as c,PutItemCommand as u}from"@aws-sdk/client-dynamodb";var S=new d({}),E=new c({}),i=async t=>{let{email:e}=t;if(!e)throw new Error("Missing required fields: to, subject, body");let n=new Date().toISOString(),o=`email-${Date.now()}`,a="Demo: Your Code",r="Here is your code: 123456";await E.send(new u({TableName:process.env.TABLE_NAME,Item:{id:{S:o},sort:{S:Date.now().toString()},to:{S:e},subject:{S:a},body:{S:r},status:{S:"sent"},timestamp:{S:n}}}));let m=new l({Source:process.env.SENDER_EMAIL,Destination:{ToAddresses:[e]},Message:{Subject:{Data:a},Body:{Text:{Data:r},Html:{Data:r.replace(/\n/g,"<br>")}}}});try{let s=await S.send(m);return{requestId:o,messageId:s.MessageId,timestamp:n,status:"sent"}}catch(s){throw new Error(`Failed to send email to ${e}: ${s instanceof Error?s.message:"Unknown error"}`)}};var g=async t=>{console.log("Step Functions send-email handler:",JSON.stringify(t,null,2));try{let{taskToken:e,...n}=t,o=await i(n);return{statusCode:200,body:JSON.stringify(o)}}catch(e){return console.error("Error in step-functions send-email:",e),{statusCode:500,body:JSON.stringify({error:"Failed to send email",details:e instanceof Error?e.message:"Unknown error"})}}};export{g as handler};

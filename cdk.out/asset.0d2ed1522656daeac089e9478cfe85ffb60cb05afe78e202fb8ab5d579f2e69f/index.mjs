import{DynamoDBClient as a,PutItemCommand as d,UpdateItemCommand as l}from"@aws-sdk/client-dynamodb";var i=new a({}),S=async s=>{console.log("Signal handler triggered:",JSON.stringify(s,null,2));try{let t=typeof s.body=="string"?JSON.parse(s.body):s.body,{requestId:e,value:n,taskToken:r}=t;if(!e)return{statusCode:400,body:JSON.stringify({error:"Missing requestId"})};if(r){if(await i.send(new l({TableName:process.env.TABLE_NAME,Key:{id:{S:e}},UpdateExpression:"SET #signal = :signal, taskToken = :token",ExpressionAttributeNames:{"#signal":"signal"},ExpressionAttributeValues:{":signal":{S:JSON.stringify(n)}}})),n!==void 0){let{SFNClient:o}=await import("@aws-sdk/client-sfn");await new o({}).send({taskToken:r,output:JSON.stringify(n)})}return{statusCode:200,body:JSON.stringify({message:"Signal sent to Step Functions",requestId:e,value:n})}}return await i.send(new d({TableName:process.env.TABLE_NAME,Item:{id:{S:`signal-${e}`},requestId:{S:e},value:{S:JSON.stringify(n)},timestamp:{S:new Date().toISOString()}}})),{statusCode:200,body:JSON.stringify({message:"Signal stored for Durable Functions",requestId:e,value:n})}}catch(t){return console.error("Error in signal handler:",t),{statusCode:500,body:JSON.stringify({error:"Failed to process signal",details:t instanceof Error?t.message:"Unknown error"})}}};export{S as handler};

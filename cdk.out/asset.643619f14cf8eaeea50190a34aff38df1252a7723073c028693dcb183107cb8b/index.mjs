import{SESClient as d,SendEmailCommand as l}from"@aws-sdk/client-ses";import{DynamoDBClient as c,PutItemCommand as S}from"@aws-sdk/client-dynamodb";var u=new d({}),E=new c({}),b=async r=>{let{to:e,subject:n,body:t,requestId:m}=r;if(!e||!n||!t)throw new Error("Missing required fields: to, subject, body");let o=new Date().toISOString(),a=m||`email-${Date.now()}`;await E.send(new S({TableName:process.env.TABLE_NAME,Item:{id:{S:a},sort:{S:Date.now().toString()},to:{S:e},subject:{S:n},body:{S:t},status:{S:"sent"},timestamp:{S:o}}}));let i=new l({Source:process.env.SENDER_EMAIL,Destination:{ToAddresses:[e]},Message:{Subject:{Data:n},Body:{Text:{Data:t},Html:{Data:t.replace(/\n/g,"<br>")}}}});try{let s=await u.send(i);return{requestId:a,messageId:s.MessageId,timestamp:o,status:"sent"}}catch(s){throw new Error(`Failed to send email to ${e}: ${s instanceof Error?s.message:"Unknown error"}`)}};export{b as sendEmail};

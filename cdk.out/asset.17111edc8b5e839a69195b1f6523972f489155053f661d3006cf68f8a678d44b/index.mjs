import{SESClient as r,SendEmailCommand as l}from"@aws-sdk/client-ses";import{DynamoDBClient as S,PutItemCommand as c}from"@aws-sdk/client-dynamodb";var u=new r({}),E=new S({}),b=async o=>{let{to:e,subject:s,body:t,requestId:a}=o;if(!e||!s||!t)throw new Error("Missing required fields: to, subject, body");let n=new Date().toISOString(),m=a||`email-${Date.now()}`;await E.send(new c({TableName:process.env.TABLE_NAME,Item:{id:{S:e},sort:{S:Date.now().toString()},to:{S:e},subject:{S:s},body:{S:t},status:{S:"sent"},timestamp:{S:n}}}));let i=new l({Source:process.env.SENDER_EMAIL,Destination:{ToAddresses:[e]},Message:{Subject:{Data:s},Body:{Text:{Data:t},Html:{Data:t.replace(/\n/g,"<br>")}}}}),d=await u.send(i);return{requestId:m,messageId:d.MessageId,timestamp:n,status:"sent"}};export{b as sendEmail};

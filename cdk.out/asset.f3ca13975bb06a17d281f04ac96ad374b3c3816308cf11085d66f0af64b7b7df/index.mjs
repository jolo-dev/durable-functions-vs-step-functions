import{DynamoDBClient as d,PutItemCommand as l,UpdateItemCommand as g}from"@aws-sdk/client-dynamodb";var i=new d({}),m=async s=>{console.log("Signal handler triggered:",JSON.stringify(s,null,2));try{let n=typeof s.body=="string"?JSON.parse(s.body):s.body,{requestId:e,code:t,taskToken:r}=n;if(!e||!t)return{statusCode:400,body:JSON.stringify({error:"Missing requestId"})};if(r){if(await i.send(new g({TableName:process.env.TABLE_NAME,Key:{id:{S:e},sort:{S:"0"}},UpdateExpression:"SET #signal = :signal",ExpressionAttributeNames:{"#signal":"signal"},ExpressionAttributeValues:{":signal":{S:JSON.stringify({code:t})}}})),value!==void 0){let{SFNClient:o,SendTaskSuccessCommand:a}=await import("@aws-sdk/client-sfn");await new o({}).send(new a({taskToken:r,output:JSON.stringify(value)}))}return{statusCode:200,body:JSON.stringify({message:"Signal sent to Step Functions",requestId:e,value})}}return await i.send(new l({TableName:process.env.TABLE_NAME,Item:{id:{S:`signal-${e}`},sort:{S:"0"},requestId:{S:e},value:{S:JSON.stringify(value)},timestamp:{S:new Date().toISOString()}}})),{statusCode:200,body:JSON.stringify({message:"Signal stored for Durable Functions",requestId:e,value})}}catch(n){return console.error("Error in signal handler:",n),{statusCode:500,body:JSON.stringify({error:"Failed to process signal",details:n instanceof Error?n.message:"Unknown error"})}}};export{m as handler};

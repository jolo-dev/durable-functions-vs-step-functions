import{DynamoDBClient as i,GetItemCommand as a}from"@aws-sdk/client-dynamodb";import{SFNClient as c,SendTaskSuccessCommand as y}from"@aws-sdk/client-sfn";var m=new c({}),f=new i({}),S=async e=>{console.log(e);let n=typeof e.body=="string"?JSON.parse(e.body):e.body,{email:s,token:t,code:o}=n;if(!t||!o)return{statusCode:400,body:JSON.stringify({error:"token and code required"})};if((await f.send(new a({TableName:process.env.TABLE_NAME,Key:{id:{S:s},sort:{S:o}}}))).Item?.code?.S!==o)return{statusCode:400,body:JSON.stringify({error:"Invalid verification code"})};let r=new y({taskToken:t,output:JSON.stringify({verification:"ok"})}),d=await m.send(r);return console.log("taskToken result",d),{statusCode:200,body:JSON.stringify({message:"Verification accepted"})}};export{S as handler};

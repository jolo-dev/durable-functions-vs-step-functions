import{DynamoDBClient as d,GetItemCommand as i}from"@aws-sdk/client-dynamodb";import{SFNClient as a,SendTaskSuccessCommand as c}from"@aws-sdk/client-sfn";var y=new a({}),m=new d({}),b=async e=>{let n=typeof e.body=="string"?JSON.parse(e.body):e.body,{email:s,token:o,code:t}=n;if(!o||!t)return{statusCode:400,body:JSON.stringify({error:"token and code required"})};if((await m.send(new i({TableName:process.env.TABLE_NAME,Key:{id:{S:s},sort:{S:t}}}))).Item?.code?.S!==t)return{statusCode:400,body:JSON.stringify({error:"Invalid verification code"})};let r=new c({taskToken:o,output:JSON.stringify({verification:"ok"})});return await y.send(r),{statusCode:200,body:JSON.stringify({message:"Verification accepted"})}};export{b as handler};

import{DynamoDBClient as d,PutItemCommand as l,UpdateItemCommand as g}from"@aws-sdk/client-dynamodb";var i=new d({}),m=async t=>{console.log("Signal handler triggered:",JSON.stringify(t,null,2));try{let s=typeof t.body=="string"?JSON.parse(t.body):t.body,{requestId:e,value:n,taskToken:r}=s;if(!e)return{statusCode:400,body:JSON.stringify({error:"Missing requestId"})};if(r){if(await i.send(new g({TableName:process.env.TABLE_NAME,Key:{id:{S:e},sort:{S:"0"}},UpdateExpression:"SET #signal = :signal",ExpressionAttributeNames:{"#signal":"signal"},ExpressionAttributeValues:{":signal":{S:JSON.stringify(n)}}})),n!==void 0){let{SFNClient:o,SendTaskSuccessCommand:a}=await import("@aws-sdk/client-sfn");await new o({}).send(new a({taskToken:r,output:JSON.stringify(n)}))}return{statusCode:200,body:JSON.stringify({message:"Signal sent to Step Functions",requestId:e,value:n})}}return await i.send(new l({TableName:process.env.TABLE_NAME,Item:{id:{S:`signal-${e}`},sort:{S:"0"},requestId:{S:e},value:{S:JSON.stringify(n)},timestamp:{S:new Date().toISOString()}}})),{statusCode:200,body:JSON.stringify({message:"Signal stored for Durable Functions",requestId:e,value:n})}}catch(s){return console.error("Error in signal handler:",s),{statusCode:500,body:JSON.stringify({error:"Failed to process signal",details:s instanceof Error?s.message:"Unknown error"})}}};export{m as handler};

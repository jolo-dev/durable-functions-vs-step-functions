import{SESClient as i,SendEmailCommand as d}from"@aws-sdk/client-ses";import{DynamoDBClient as l,PutItemCommand as c}from"@aws-sdk/client-dynamodb";var u=new i({}),S=new l({}),D=async r=>{let{email:e}=r;if(!e)throw new Error("Missing required fields: to, subject, body");let o=new Date().toISOString(),n=`email-${Date.now()}`,a="Demo: Your Code",s="Here is your code: 123456";await S.send(new c({TableName:process.env.TABLE_NAME,Item:{id:{S:n},sort:{S:Date.now().toString()},to:{S:e},subject:{S:a},body:{S:s},status:{S:"sent"},timestamp:{S:o}}}));let m=new d({Source:process.env.SENDER_EMAIL,Destination:{ToAddresses:[e]},Message:{Subject:{Data:a},Body:{Text:{Data:s},Html:{Data:s.replace(/\n/g,"<br>")}}}});try{let t=await u.send(m);return{requestId:n,messageId:t.MessageId,timestamp:o,status:"sent"}}catch(t){throw new Error(`Failed to send email to ${e}: ${t instanceof Error?t.message:"Unknown error"}`)}};export{D as sendEmail};

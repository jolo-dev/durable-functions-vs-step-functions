import{SESClient as d,SendEmailCommand as l}from"@aws-sdk/client-ses";import{DynamoDBClient as c,PutItemCommand as u}from"@aws-sdk/client-dynamodb";var S=new d({}),E=new c({}),i=async t=>{let{email:e}=t;if(!e)throw new Error("Missing required fields: to, subject, body");let s=new Date().toISOString(),r=`email-${Date.now()}`,a="Demo: Your Code",o="Here is your code: 123456";await E.send(new u({TableName:process.env.TABLE_NAME,Item:{id:{S:r},sort:{S:Date.now().toString()},to:{S:e},subject:{S:a},body:{S:o},status:{S:"sent"},timestamp:{S:s}}}));let m=new l({Source:process.env.SENDER_EMAIL,Destination:{ToAddresses:[e]},Message:{Subject:{Data:a},Body:{Text:{Data:o},Html:{Data:o.replace(/\n/g,"<br>")}}}});try{let n=await S.send(m);return{requestId:r,messageId:n.MessageId,timestamp:s,status:"sent"}}catch(n){throw new Error(`Failed to send email to ${e}: ${n instanceof Error?n.message:"Unknown error"}`)}};var g=async t=>{console.log("Step Functions send-email handler:",JSON.stringify(t,null,2));try{let e=await i(t);return{statusCode:200,body:JSON.stringify(e)}}catch(e){return console.error("Error in step-functions send-email:",e),{statusCode:500,body:JSON.stringify({error:"Failed to send email",details:e instanceof Error?e.message:"Unknown error"})}}};export{g as handler};

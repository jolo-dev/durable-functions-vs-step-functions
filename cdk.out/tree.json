{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.233.0"},"children":{"DurableFunctionsVsStepFunctions":{"id":"DurableFunctionsVsStepFunctions","path":"DurableFunctionsVsStepFunctions","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.233.0"},"children":{"StateTable":{"id":"StateTable","path":"DurableFunctionsVsStepFunctions/StateTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/StateTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"id","attributeType":"S"},{"attributeName":"sort","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"id","keyType":"HASH"},{"attributeName":"sort","keyType":"RANGE"}],"tableName":"MagicCode"}}},"ScalingRole":{"id":"ScalingRole","path":"DurableFunctionsVsStepFunctions/StateTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}}}},"SenderIdentity":{"id":"SenderIdentity","path":"DurableFunctionsVsStepFunctions/SenderIdentity","constructInfo":{"fqn":"aws-cdk-lib.aws_ses.EmailIdentity","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/SenderIdentity/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ses.CfnEmailIdentity","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SES::EmailIdentity","aws:cdk:cloudformation:props":{"emailIdentity":"johnyscrazy@gmail.com"}}}}},"IsCodeCorrect?":{"id":"IsCodeCorrect?","path":"DurableFunctionsVsStepFunctions/IsCodeCorrect?","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Choice","version":"2.233.0"}},"Success":{"id":"Success","path":"DurableFunctionsVsStepFunctions/Success","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Succeed","version":"2.233.0"}},"IncorrectCode":{"id":"IncorrectCode","path":"DurableFunctionsVsStepFunctions/IncorrectCode","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.Fail","version":"2.233.0"}},"StepSendEmail":{"id":"StepSendEmail","path":"DurableFunctionsVsStepFunctions/StepSendEmail","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.233.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"DurableFunctionsVsStepFunctions/StepSendEmail/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"DurableFunctionsVsStepFunctions/StepSendEmail/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/StepSendEmail/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"DurableFunctionsVsStepFunctions/StepSendEmail/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/StepSendEmail/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":{"Fn::GetAtt":["StateTable9728C7E5","Arn"]}},{"Action":["ses:SendEmail","ses:SendRawEmail"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":ses:eu-central-1:246350246460:identity/",{"Ref":"SenderIdentity5AECAF6F"}]]}}],"Version":"2012-10-17"},"policyName":"StepSendEmailServiceRoleDefaultPolicyBC52E8B9","roles":[{"Ref":"StepSendEmailServiceRole0D8D9D68"}]}}}}}}},"Code":{"id":"Code","path":"DurableFunctionsVsStepFunctions/StepSendEmail/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.233.0"},"children":{"Stage":{"id":"Stage","path":"DurableFunctionsVsStepFunctions/StepSendEmail/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.233.0"}},"AssetBucket":{"id":"AssetBucket","path":"DurableFunctionsVsStepFunctions/StepSendEmail/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.233.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/StepSendEmail/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-246350246460-eu-central-1","s3Key":"785699e3c33df5fab201d7405abdfba6c14f9fcb27172a705017a2a19c606caf.zip"},"environment":{"variables":{"TABLE_NAME":{"Ref":"StateTable9728C7E5"},"SENDER_EMAIL":"johnyscrazy@gmail.com"}},"functionName":"step-send-email","handler":"index.handler","role":{"Fn::GetAtt":["StepSendEmailServiceRole0D8D9D68","Arn"]},"runtime":"nodejs24.x","timeout":30}}}}},"SendEmailStep":{"id":"SendEmailStep","path":"DurableFunctionsVsStepFunctions/SendEmailStep","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions_tasks.LambdaInvoke","version":"2.233.0"}},"EmailStateMachine":{"id":"EmailStateMachine","path":"DurableFunctionsVsStepFunctions/EmailStateMachine","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.StateMachine","version":"2.233.0","metadata":[]},"children":{"Role":{"id":"Role","path":"DurableFunctionsVsStepFunctions/EmailStateMachine/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"ImportRole":{"id":"ImportRole","path":"DurableFunctionsVsStepFunctions/EmailStateMachine/Role/ImportRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailStateMachine/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"states.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"DurableFunctionsVsStepFunctions/EmailStateMachine/Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailStateMachine/Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["StepSendEmailCD418E23","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["StepSendEmailCD418E23","Arn"]},":*"]]}]}],"Version":"2012-10-17"},"policyName":"EmailStateMachineRoleDefaultPolicy0E14564F","roles":[{"Ref":"EmailStateMachineRole2F9DF81E"}]}}}}}}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailStateMachine/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_stepfunctions.CfnStateMachine","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::StepFunctions::StateMachine","aws:cdk:cloudformation:props":{"definitionString":{"Fn::Join":["",["{\"StartAt\":\"SendEmailStep\",\"States\":{\"SendEmailStep\":{\"Next\":\"IsCodeCorrect?\",\"Retry\":[{\"ErrorEquals\":[\"Lambda.ClientExecutionTimeoutException\",\"Lambda.ServiceException\",\"Lambda.AWSLambdaException\",\"Lambda.SdkClientException\"],\"IntervalSeconds\":2,\"MaxAttempts\":6,\"BackoffRate\":2}],\"Type\":\"Task\",\"Resource\":\"arn:",{"Ref":"AWS::Partition"},":states:::lambda:invoke.waitForTaskToken\",\"Parameters\":{\"FunctionName\":\"",{"Fn::GetAtt":["StepSendEmailCD418E23","Arn"]},"\",\"Payload\":{\"email.$\":\"$.email\",\"taskToken.$\":\"$$.Task.Token\"}}},\"IsCodeCorrect?\":{\"Type\":\"Choice\",\"Choices\":[{\"Variable\":\"$.verification\",\"StringEquals\":\"ok\",\"Next\":\"Success\"}],\"Default\":\"IncorrectCode\"},\"IncorrectCode\":{\"Type\":\"Fail\",\"Error\":\"IncorrectCode\",\"Cause\":\"Verification code did not match\"},\"Success\":{\"Type\":\"Succeed\"}},\"TimeoutSeconds\":900}"]]},"roleArn":{"Fn::GetAtt":["EmailStateMachineRole2F9DF81E","Arn"]},"stateMachineName":"EmailProcessingWorkflow"}}}}},"DurableHandler":{"id":"DurableHandler","path":"DurableFunctionsVsStepFunctions/DurableHandler","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.233.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"DurableFunctionsVsStepFunctions/DurableHandler/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"DurableFunctionsVsStepFunctions/DurableHandler/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/DurableHandler/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicDurableExecutionRolePolicy"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"DurableFunctionsVsStepFunctions/DurableHandler/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/DurableHandler/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":{"Fn::GetAtt":["StateTable9728C7E5","Arn"]}},{"Action":["ses:SendEmail","ses:SendRawEmail"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":ses:eu-central-1:246350246460:identity/",{"Ref":"SenderIdentity5AECAF6F"}]]}}],"Version":"2012-10-17"},"policyName":"DurableHandlerServiceRoleDefaultPolicy6B3EA19D","roles":[{"Ref":"DurableHandlerServiceRoleB2BB3DAD"}]}}}}}}},"Code":{"id":"Code","path":"DurableFunctionsVsStepFunctions/DurableHandler/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.233.0"},"children":{"Stage":{"id":"Stage","path":"DurableFunctionsVsStepFunctions/DurableHandler/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.233.0"}},"AssetBucket":{"id":"AssetBucket","path":"DurableFunctionsVsStepFunctions/DurableHandler/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.233.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/DurableHandler/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-246350246460-eu-central-1","s3Key":"6dd6b60eb3fffe2d4393e9b145827b6e4d8ca3c59aac608ceea9865239352d64.zip"},"durableConfig":{"executionTimeout":900},"environment":{"variables":{"TABLE_NAME":{"Ref":"StateTable9728C7E5"}}},"functionName":"durable-handler","handler":"index.handler","role":{"Fn::GetAtt":["DurableHandlerServiceRoleB2BB3DAD","Arn"]},"runtime":"nodejs24.x"}}}}},"DurableInvoker":{"id":"DurableInvoker","path":"DurableFunctionsVsStepFunctions/DurableInvoker","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.233.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"DurableFunctionsVsStepFunctions/DurableInvoker/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"DurableFunctionsVsStepFunctions/DurableInvoker/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/DurableInvoker/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"DurableFunctionsVsStepFunctions/DurableInvoker/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/DurableInvoker/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"lambda:InvokeFunction","Effect":"Allow","Resource":[{"Fn::GetAtt":["DurableHandler3C0774E3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["DurableHandler3C0774E3","Arn"]},":*"]]}]}],"Version":"2012-10-17"},"policyName":"DurableInvokerServiceRoleDefaultPolicyEF099CF7","roles":[{"Ref":"DurableInvokerServiceRole27025B81"}]}}}}}}},"Code":{"id":"Code","path":"DurableFunctionsVsStepFunctions/DurableInvoker/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.233.0"},"children":{"Stage":{"id":"Stage","path":"DurableFunctionsVsStepFunctions/DurableInvoker/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.233.0"}},"AssetBucket":{"id":"AssetBucket","path":"DurableFunctionsVsStepFunctions/DurableInvoker/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.233.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/DurableInvoker/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-246350246460-eu-central-1","s3Key":"c2eacfcd3afe381b5e9d6e85aee3a50ff0ab8e92c16d441342c92c34bf54dd82.zip"},"environment":{"variables":{"FUNCTION_ARN":{"Fn::GetAtt":["DurableHandler3C0774E3","Arn"]}}},"functionName":"durable-invoker","handler":"index.handler","role":{"Fn::GetAtt":["DurableInvokerServiceRole27025B81","Arn"]},"runtime":"nodejs24.x"}}}}},"TokenHandler":{"id":"TokenHandler","path":"DurableFunctionsVsStepFunctions/TokenHandler","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda_nodejs.NodejsFunction","version":"2.233.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"DurableFunctionsVsStepFunctions/TokenHandler/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"DurableFunctionsVsStepFunctions/TokenHandler/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/TokenHandler/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"DurableFunctionsVsStepFunctions/TokenHandler/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/TokenHandler/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"states:SendTaskSuccess","Effect":"Allow","Resource":{"Ref":"EmailStateMachine78CA490A"}},{"Action":["lambda:SendDurableExecutionCallbackSuccess","lambda:SendDurableExecutionCallbackFailure"],"Effect":"Allow","Resource":[{"Fn::Join":["",[{"Fn::GetAtt":["DurableHandler3C0774E3","Arn"]},":*"]]},{"Fn::GetAtt":["DurableHandler3C0774E3","Arn"]}]},{"Action":["dynamodb:BatchGetItem","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":{"Fn::GetAtt":["StateTable9728C7E5","Arn"]}},{"Action":["dynamodb:GetRecords","dynamodb:GetShardIterator"],"Effect":"Allow","Resource":{"Fn::GetAtt":["StateTable9728C7E5","Arn"]}}],"Version":"2012-10-17"},"policyName":"TokenHandlerServiceRoleDefaultPolicy47E9CCED","roles":[{"Ref":"TokenHandlerServiceRole5F6EEBA1"}]}}}}}}},"Code":{"id":"Code","path":"DurableFunctionsVsStepFunctions/TokenHandler/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.233.0"},"children":{"Stage":{"id":"Stage","path":"DurableFunctionsVsStepFunctions/TokenHandler/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.233.0"}},"AssetBucket":{"id":"AssetBucket","path":"DurableFunctionsVsStepFunctions/TokenHandler/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.233.0","metadata":[]}}}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/TokenHandler/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"s3Bucket":"cdk-hnb659fds-assets-246350246460-eu-central-1","s3Key":"56cfcfcba5111906d5b3177ee2f569697aa51f017fd78dfcba5992d15e5effaf.zip"},"environment":{"variables":{"TABLE_NAME":{"Ref":"StateTable9728C7E5"},"DURABLE_FUNCTION":{"Fn::GetAtt":["DurableHandler3C0774E3","Arn"]}}},"functionName":"token-handler","handler":"index.handler","role":{"Fn::GetAtt":["TokenHandlerServiceRole5F6EEBA1","Arn"]},"runtime":"nodejs24.x"}}}}},"EmailHttpApi":{"id":"EmailHttpApi","path":"DurableFunctionsVsStepFunctions/EmailHttpApi","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpApi","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnApi","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Api","aws:cdk:cloudformation:props":{"description":"HTTP API for email processing with durable and step functions","name":"Email Service API","protocolType":"HTTP"}}},"DefaultStage":{"id":"DefaultStage","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/DefaultStage","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpStage","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/DefaultStage/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnStage","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Stage","aws:cdk:cloudformation:props":{"accessLogSettings":{"destinationArn":{"Fn::GetAtt":["DurableFunctionsVsStepFunctionslogs1A0FCD73","Arn"]},"format":"{\"requestId\":\"$context.requestId\",\"ip\":\"$context.identity.sourceIp\",\"caller\":\"$context.identity.caller\",\"user\":\"$context.identity.user\",\"requestTime\":\"$context.requestTime\",\"httpMethod\":\"$context.httpMethod\",\"resourcePath\":\"$context.resourcePath\",\"status\":\"$context.status\",\"protocol\":\"$context.protocol\",\"responseLength\":\"$context.responseLength\"}"},"apiId":{"Ref":"EmailHttpApiE2EBE3BB"},"autoDeploy":true,"stageName":"$default"}}}}},"POST--steps":{"id":"POST--steps","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--steps","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpRoute","version":"2.233.0","metadata":[]},"children":{"InvokeRole":{"id":"InvokeRole","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--steps/InvokeRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.233.0","metadata":[]},"children":{"ImportInvokeRole":{"id":"ImportInvokeRole","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--steps/InvokeRole/ImportInvokeRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.233.0","metadata":[]}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--steps/InvokeRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"apigateway.amazonaws.com"}}],"Version":"2012-10-17"}}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--steps/InvokeRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--steps/InvokeRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"states:StartExecution","Effect":"Allow","Resource":{"Ref":"EmailStateMachine78CA490A"},"Sid":"AllowStepFunctionsExecution"}],"Version":"2012-10-17"},"policyName":"EmailHttpApiPOSTstepsInvokeRoleDefaultPolicy0F58DDCC","roles":[{"Ref":"EmailHttpApiPOSTstepsInvokeRole791E46DA"}]}}}}}}},"StepsIntegration":{"id":"StepsIntegration","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--steps/StepsIntegration","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpIntegration","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--steps/StepsIntegration/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnIntegration","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Integration","aws:cdk:cloudformation:props":{"apiId":{"Ref":"EmailHttpApiE2EBE3BB"},"connectionType":"INTERNET","credentialsArn":{"Fn::GetAtt":["EmailHttpApiPOSTstepsInvokeRole791E46DA","Arn"]},"integrationSubtype":"StepFunctions-StartExecution","integrationType":"AWS_PROXY","payloadFormatVersion":"1.0","requestParameters":{"Input":"$request.body","StateMachineArn":{"Ref":"EmailStateMachine78CA490A"}}}}}}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--steps/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"EmailHttpApiE2EBE3BB"},"authorizationType":"NONE","routeKey":"POST /steps","target":{"Fn::Join":["",["integrations/",{"Ref":"EmailHttpApiPOSTstepsStepsIntegrationDFD627DB"}]]}}}}}},"POST--durable":{"id":"POST--durable","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--durable","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpRoute","version":"2.233.0","metadata":[]},"children":{"DurableIntegration":{"id":"DurableIntegration","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--durable/DurableIntegration","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpIntegration","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--durable/DurableIntegration/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnIntegration","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Integration","aws:cdk:cloudformation:props":{"apiId":{"Ref":"EmailHttpApiE2EBE3BB"},"integrationType":"AWS_PROXY","integrationUri":{"Fn::GetAtt":["DurableInvoker914F067D","Arn"]},"payloadFormatVersion":"2.0"}}}}},"DurableIntegration-Permission":{"id":"DurableIntegration-Permission","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--durable/DurableIntegration-Permission","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["DurableInvoker914F067D","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":execute-api:eu-central-1:246350246460:",{"Ref":"EmailHttpApiE2EBE3BB"},"/*/*/durable"]]}}}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--durable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"EmailHttpApiE2EBE3BB"},"authorizationType":"NONE","routeKey":"POST /durable","target":{"Fn::Join":["",["integrations/",{"Ref":"EmailHttpApiPOSTdurableDurableIntegrationEC0C48A4"}]]}}}}}},"POST--token":{"id":"POST--token","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--token","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpRoute","version":"2.233.0","metadata":[]},"children":{"Token":{"id":"Token","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--token/Token","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpIntegration","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--token/Token/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnIntegration","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Integration","aws:cdk:cloudformation:props":{"apiId":{"Ref":"EmailHttpApiE2EBE3BB"},"integrationType":"AWS_PROXY","integrationUri":{"Fn::GetAtt":["TokenHandler84BB90A6","Arn"]},"payloadFormatVersion":"2.0"}}}}},"Token-Permission":{"id":"Token-Permission","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--token/Token-Permission","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["TokenHandler84BB90A6","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":execute-api:eu-central-1:246350246460:",{"Ref":"EmailHttpApiE2EBE3BB"},"/*/*/token"]]}}}},"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/EmailHttpApi/POST--token/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"EmailHttpApiE2EBE3BB"},"authorizationType":"NONE","routeKey":"POST /token","target":{"Fn::Join":["",["integrations/",{"Ref":"EmailHttpApiPOSTtokenToken8AD70EE0"}]]}}}}}}}},"DurableFunctionsVsStepFunctions-logs":{"id":"DurableFunctionsVsStepFunctions-logs","path":"DurableFunctionsVsStepFunctions/DurableFunctionsVsStepFunctions-logs","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogGroup","version":"2.233.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"DurableFunctionsVsStepFunctions/DurableFunctionsVsStepFunctions-logs/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.CfnLogGroup","version":"2.233.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Logs::LogGroup","aws:cdk:cloudformation:props":{"logGroupName":"/aws/vendedlogs/aws-apigatewayv2/DurableFunctionsVsStepFunctions/logs","retentionInDays":731}}}}},"ApiUrl":{"id":"ApiUrl","path":"DurableFunctionsVsStepFunctions/ApiUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"StateMachineArn":{"id":"StateMachineArn","path":"DurableFunctionsVsStepFunctions/StateMachineArn","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.233.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"DurableFunctionsVsStepFunctions/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"},"children":{"Default":{"id":"Default","path":"DurableFunctionsVsStepFunctions/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.233.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"DurableFunctionsVsStepFunctions/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.233.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"DurableFunctionsVsStepFunctions/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.233.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.4"}}}}}
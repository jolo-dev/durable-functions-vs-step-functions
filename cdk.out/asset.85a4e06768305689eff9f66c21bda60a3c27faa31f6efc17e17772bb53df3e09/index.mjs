import{SESClient as l,SendEmailCommand as c}from"@aws-sdk/client-ses";import{DynamoDBClient as u,PutItemCommand as S}from"@aws-sdk/client-dynamodb";var p=new l({}),E=new u({}),a=async t=>{let{to:e,subject:s,body:n,requestId:i}=t;if(!e||!s||!n)throw new Error("Missing required fields: to, subject, body");let o=new Date().toISOString(),r=i||`email-${Date.now()}`;await E.send(new S({TableName:process.env.TABLE_NAME,Item:{id:{S:r},to:{S:e},subject:{S:s},body:{S:n},status:{S:"sent"},timestamp:{S:o}}}));let m=new c({Source:process.env.SENDER_EMAIL,Destination:{ToAddresses:[e]},Message:{Subject:{Data:s},Body:{Text:{Data:n},Html:{Data:n.replace(/\n/g,"<br>")}}}}),d=await p.send(m);return{requestId:r,messageId:d.MessageId,timestamp:o,status:"sent"}};var g=async t=>{console.log("Step Functions send-email handler:",JSON.stringify(t,null,2));try{let e=await a(t);return{statusCode:200,body:JSON.stringify(e)}}catch(e){return console.error("Error in step-functions send-email:",e),{statusCode:500,body:JSON.stringify({error:"Failed to send email",details:e instanceof Error?e.message:"Unknown error"})}}};export{g as handler};
